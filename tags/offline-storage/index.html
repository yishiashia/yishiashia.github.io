<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Offline storage | yishiashia's Blog</title>
<meta name=keywords content><meta name=description content="yishiashia 的部落格，主要分享前後端開發與系統建置維護的心得。"><meta name=author content="yishiashia"><link rel=canonical href=https://yishiashia.github.io/tags/offline-storage/><link crossorigin=anonymous href=/assets/css/stylesheet.4963a5a8b48ed6d0059c86acc7f948b95b16e935fd9b6b4a8a5a29a5a288346a.css integrity="sha256-SWOlqLSO1tAFnIasx/lIuVsW6TX9m2tKiloppaKINGo=" rel="preload stylesheet" as=style><link rel=icon href=https://yishiashia.github.io/favicon.ico media="(prefers-color-scheme: light)"><link rel=icon href=https://yishiashia.github.io/favicon-dark.ico media="(prefers-color-scheme: dark)"><link rel=icon type=image/png sizes=16x16 href=https://yishiashia.github.io/favicon-16x16.png media="(prefers-color-scheme: light)"><link rel=icon type=image/png sizes=32x32 href=https://yishiashia.github.io/favicon-32x32.png media="(prefers-color-scheme: light)"><link rel=icon type=image/png sizes=16x16 href=https://yishiashia.github.io/favicon-dark-16x16.png media="(prefers-color-scheme: dark)"><link rel=icon type=image/png sizes=32x32 href=https://yishiashia.github.io/favicon-dark-32x32.png media="(prefers-color-scheme: dark)"><link rel=apple-touch-icon href=https://yishiashia.github.io/apple-touch-icon.png><link rel=apple-touch-icon sizes=57x57 href=https://yishiashia.github.io/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://yishiashia.github.io/apple-touch-icon-60x60.png><link rel=mask-icon href=https://yishiashia.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://yishiashia.github.io/tags/offline-storage/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-7BRX4099BG"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-7BRX4099BG",{anonymize_ip:!1})}</script><meta property="og:title" content="Offline storage"><meta property="og:description" content="yishiashia 的部落格，主要分享前後端開發與系統建置維護的心得。"><meta property="og:type" content="website"><meta property="og:url" content="https://yishiashia.github.io/tags/offline-storage/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Offline storage"><meta name=twitter:description content="yishiashia 的部落格，主要分享前後端開發與系統建置維護的心得。"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yishiashia.github.io/ accesskey=h title="  (Alt + H)"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 464 466"><g transform="translate(0.000000,466.000000) scale(0.100000,-0.100000)" fill="currentcolor" stroke="none"><path d="M3e2 4473c-56-24-98-61-123-106-20-38-22-56-21-172 0-1e2 5-148 22-208 12-43 23-81 26-85 3-5 7-20 10-34 6-35 75-233 92-266 8-15 14-36 14-48 0-22 33-108 82-214 16-36 39-90 50-120s26-62 33-70 20-32 28-52c9-20 36-68 61-107 26-39 50-81 56-95 5-14 35-60 67-102s67-89 78-105c11-15 47-50 81-78 33-27 61-56 61-63 2-57 25-264 33-308 6-30 13-70 16-88 2-18 9-42 14-53 6-10 15-45 21-76 6-32 17-71 24-88 7-16 21-50 30-75s25-65 35-90l18-46-77-39c-49-26-94-59-125-93-28-30-63-60-78-68s-39-31-53-52c-14-20-45-62-70-92-69-85-173-304-195-410-7-30-15-68-18-85-4-16-7-95-7-175 1-132 3-152 29-228 15-45 31-82 35-82s27-27 52-60c36-50 56-67 114-94 39-19 88-39 110-45 44-12 886-16 994-5l61 7v98 99h-140-140v406 406l23-14c12-8 40-21 62-28s57-24 79-37c55-35 240-98 257-87 4 2 10 0 13-5 14-21 295-37 406-22 151 20 333 72 393 114 43 30 147 68 148 54 3-62 4-694 1-734l-4-52-151-3-152-3-3-74c-3-69-1-76 24-102l28-29h193c154 0 2e2 3 223 15 61 32 60 21 60 618v544l23 25c151 167 251 308 299 421 16 40 39 91 49 113 49 110 83 290 95 504 7 119 8 120 107 197 31 24 57 50 57 57s27 44 60 82 63 80 66 94c4 14 18 41 33 60 29 38 141 232 141 244 0 4 25 59 55 121 30 63 55 117 55 120s8 24 19 48c10 23 29 76 41 117 13 41 28 84 35 96 7 11 21 49 31 85 10 35 29 93 42 129 48 132 54 162 55 290 1 142-9 190-53 238-75 82-188 102-321 58-91-30-223-88-304-134-91-52-124-74-128-85-3-7-23-19-46-27-22-7-49-22-58-33-10-10-27-23-38-27-11-5-62-40-114-79-84-63-167-150-230-238-12-18-31-33-41-33s-40 18-66 41c-47 38-220 129-247 129-7 0-17 4-23 9-8 8-160 51-194 56-8 1-24 5-35 10s-114 10-230 10c-219 0-293-3-310-14-5-4-23-8-40-10-35-4-231-68-260-85-11-7-39-18-62-24-22-7-63-27-90-45-73-50-78-51-114-9-36 41-2e2 178-279 232-28 19-73 52-101 73-28 20-56 37-63 37-6 0-51 27-1e2 60s-98 62-108 66c-10 3-18 9-18 14 0 4-12 11-27 15-16 3-47 15-70 26-24 10-62 28-86 38-112 51-236 65-307 34zm3934-209c16-22 18-37 12-98-7-88-10-109-18-121-3-6-9-26-12-45-4-19-11-46-16-60s-16-52-26-85-23-69-30-80c-6-11-17-45-24-75s-18-65-26-77-14-29-14-36c0-8-20-55-45-106-25-50-45-96-45-101 0-17-78-176-113-231-19-30-48-81-65-115-17-33-41-73-54-88-66-79-77-90-78-76-2 37-35 238-43 260-3 8-11 33-17 55-7 22-35 90-63 150-41 90-68 130-144 220-51 61-93 116-93 123 0 31 43 92 105 147 36 33 79 72 95 87s46 35 67 43c21 9 49 26 63 39 31 28 123 86 137 86 6 0 33 15 61 33 111 72 172 106 197 107 11 1 52 16 90 35 39 18 72 34 75 34s13-11 24-25zm-3733-14c41-16 77-30 82-30 4 0 51-26 105-57 53-31 124-70 157-87s94-56 135-87c42-31 87-62 1e2-69 44-23 153-120 224-199 18-20 18-21-37-81-31-33-68-77-83-98-15-20-42-53-59-72-18-19-40-57-50-84s-28-65-41-83c-12-19-26-48-30-66-3-18-17-54-29-82-23-50-53-185-57-260l-3-40-35 48c-19 27-47 63-61 80-15 18-30 43-34 57s-31 66-61 116c-30 51-54 95-54 99s-7 21-15 38c-8 18-24 57-35 87-12 30-26 60-32 67-5 7-21 43-35 80-35 95-74 206-77 218-1 6-7 20-14 32s-15 44-19 70c-3 26-9 53-13 58-4 6-22 68-40 138-32 130-34 175-7 218 16 26 33 24 118-11zm2079-416c153-37 231-66 334-125 117-67 180-116 261-204 73-78 185-224 185-241 0-12 34-96 51-127 9-17 41-138 60-227 10-46 14-448 5-457-3-3-18 6-33 21-89 83-124 103-219 126-119 29-198 19-314-38-44-21-132-104-150-140-8-15-19-34-26-42-42-55-57-221-29-317 20-66 31-87 85-156 93-120 287-184 438-144 31 8 28-3-13-43-19-19-35-41-35-49 0-24-180-190-278-257-52-35-112-69-135-75s-46-14-52-18c-17-13-130-51-178-60l-45-8 21 41c12 23 27 47 34 54s13 19 13 27c0 7 7 26 15 41 28 54 37 129 25 191-21 101-127 201-230 219-65 10-123 12-135 4-5-3-21-7-33-8-70-3-188-112-209-191-7-25-13-61-13-79 0-63 38-167 86-237 19-27 18-55-3-55-16 0-108 31-233 78-56 21-167 93-239 155-30 26-58 47-61 47-4 0-23 21-44 47-20 27-59 77-87 112-27 35-48 65-46 67 2 3 17 0 33-6 71-27 213-1 306 57 21 13 42 23 46 23 10 0 102 114 102 125 0 4 8 19 19 33 48 68 53 273 8 354-38 70-43 77-78 116-94 102-188 146-314 146-102 0-207-34-250-79-21-23-87-67-92-62-8 9-9 346-1 405 17 119 39 198 85 3e2 12 29 23 57 23 63 0 18 29 67 67 112 21 25 52 64 68 87 36 51 138 151 185 184 117 80 199 126 263 146 39 13 77 26 82 30 11 8 73 23 77 19 2-1 12 3 23 9 20 10 42 14 165 33 96 14 294 1 410-27zM1531 2386c54-19 116-74 133-117 18-45 20-108 5-162-12-45-79-112-127-128-52-17-130-6-195 26-71 36-87 65-95 163-4 64-2 79 18 115 25 45 28 47 99 89 51 30 105 35 162 14zm1686-12c99-52 123-88 123-182 0-47-25-129-47-154-40-44-180-89-209-66-7 5-16 7-20 6-5-2-33 12-62 30-114 70-136 228-43 320 73 73 173 91 258 46zm-878-739c34-17 41-32 41-93 0-59-17-93-53-105-41-13-75-1-97 36-25 40-25 86-3 126 29 49 65 61 112 36zm-976-234 27-33V884 4e2h-267c-193 0-275 4-292 13-45 22-108 111-120 169-24 112-15 285 17 368 5 14 9 27 9 30s9 23 20 45c12 22 26 58 32 80 18 67 137 226 221 296 41 34 78 66 81 71s34 23 70 42l64 33 55-57c30-31 67-71 83-89z"/></g></svg></a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yishiashia.github.io/ title="yishiashia's Blog"><span>Home</span></a></li><li><a href=https://yishiashia.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://yishiashia.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://yishiashia.github.io/posts/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://yishiashia.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://yishiashia.github.io/tags/>Tags</a></div><h1>Offline storage</h1></header><article class="post-entry tag-entry"><figure class=entry-cover><img srcset="https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/0_SE5YTSIGxPUrOgGS_hu79b8488ea12b18d042755aee9a706b59_63064_1080x0_resize_q75_h2_box_2.webp 1080w ,https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/0_SE5YTSIGxPUrOgGS_hu79b8488ea12b18d042755aee9a706b59_63064_720x0_resize_q75_h2_box_2.webp 720w ,https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/0_SE5YTSIGxPUrOgGS_hu79b8488ea12b18d042755aee9a706b59_63064_480x0_resize_q75_h2_box_2.webp 480w ,https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/0_SE5YTSIGxPUrOgGS_hu79b8488ea12b18d042755aee9a706b59_63064_360x0_resize_q75_h2_box_2.webp 360w ,https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/0_SE5YTSIGxPUrOgGS.webp 1400w" sizes="(min-width: 768px) 720px, 100vw" src=https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/0_SE5YTSIGxPUrOgGS.webp alt="Photo by [Scott Graham](https://unsplash.com/@homajob) on [Unsplash](https://unsplash.com/)" width=1400 height=934></figure><div><header class=entry-header><h2>使用 indexedDB 離線儲存圖片</h2></header><div class=entry-content><p>緣起 由於最近碰到要在負責的網頁式聊天機器人中，新增如同Line聊天室的貼圖功能，可想而知會有大量的貼圖圖片會需要在用戶裝置瀏覽器進行下載，不管是對圖片伺服器或是用戶等待的過程來說都是不小的負擔。
為了解決這個問題，透過使用了 PWA (Progressive Web App) 技術中常用的離線儲存方案 indexedDB 來快取貼圖圖片，不僅減少用戶端與網站伺服器端的連線流量，也提升的用戶體驗(UX: User Experience) 。
Service Worker Service Worker是一個事件驅動的網站 Worker，根據不同的來源 (origin) 與網址路徑 (path) 進行註冊後，之後再次訪問同一網站後即會在背景執行這個 Service Worker。
Service Worker 無法直接存取 DOM 物件，他負責監聽和處理像是 fetch, notification(推播), sync 還有 Service Worker 註冊、啟動 等相關事件。
透過處理上述事件，我們可以讓 web 網頁像一般的手機原生 App 一樣可以執行安裝、發送推播、離線瀏覽及連線後同步等等作業。
離線儲存 常見的 Ｗeb 儲存方案有下面幾種:
Cookie LocalStorage Cache (precache) indexedDB 一般 SPA (Single Page Application) 中比較常用的是 Cookie 跟 LocalStorage 兩種儲存方法，不過在使用上都會有大小的限制（無法儲存較大的網站資源），像是 LocalStorage 的限制依照瀏覽器不同會落在大約 2MB ~ 10MB 左右，超過後就會發出Error。
而在 PWA 的離線儲存上通常會使用 Cache(precache) 或 indexedDB 來實作，它們的大小通常跟使用者裝置的 disk 空間有關係，以 Chrome 為例，所有網站可以用的共享儲存空間為硬碟可用空間的1/3, 每個網站 App 可以使用共享空間中的 20%。...</p></div><footer class=entry-footer><span title='2022-10-07 15:51:22 +0800 +0800'>October 7, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;yishiashia</footer><a class=entry-link aria-label="post link to 使用 indexedDB 離線儲存圖片" href=https://yishiashia.github.io/posts/offline-image-storage-using-indexeddb/></a></div></article></main><footer class=footer><span>Copyright © 2023 <a href=mailto:yishiashia@gmail.com target=_blank rel="external nofollow noreferrer noopener">yishiashia@gmail.com</a>. All rights reserved.</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>